"use strict";(self.webpackChunkcivitai_developer=self.webpackChunkcivitai_developer||[]).push([[4082],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>k});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),u=d(n),c=r,k=u["".concat(s,".").concat(c)]||u[c]||m[c]||i;return n?a.createElement(k,l(l({ref:t},p),{},{components:n})):a.createElement(k,l({ref:t},p))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[u]="string"==typeof e?e:r,l[1]=o;for(var d=2;d<i;d++)l[d]=n[d];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},89744:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var a=n(87462),r=(n(67294),n(3905));const i={title:"JavaScript SDK"},l="Civitai Generator Node.js Client",o={unversionedId:"api/sdk/README",id:"api/sdk/README",title:"JavaScript SDK",description:"A node.js client for Civitai's generator to run Civitai models from your Node.js code.",source:"@site/docs/api/sdk/README.md",sourceDirName:"api/sdk",slug:"/api/sdk/",permalink:"/developer/docs/api/sdk/",draft:!1,tags:[],version:"current",frontMatter:{title:"JavaScript SDK"},sidebar:"tutorialSidebar",previous:{title:"Public REST API",permalink:"/developer/docs/api/public-rest"},next:{title:"Link",permalink:"/developer/docs/link"}},s={},d=[{value:"Installation",id:"installation",level:2},{value:"Usage",id:"usage",level:2},{value:"Create the client:",id:"create-the-client",level:4},{value:"Create a txt2img job:",id:"create-a-txt2img-job",level:4},{value:"Using Additional Networks",id:"using-additional-networks",level:3},{value:"API",id:"api",level:2},{value:"Constructor",id:"constructor",level:3},{value:"<code>civitai.image.fromText</code>",id:"civitaiimagefromtext",level:3},{value:"Additional Networks",id:"additional-networks",level:4},{value:"ControlNets",id:"controlnets",level:4},{value:"<code>civitai.jobs.getById</code>",id:"civitaijobsgetbyid",level:3},{value:"<code>civitai.jobs.getByToken</code>",id:"civitaijobsgetbytoken",level:3},{value:"<code>civitai.jobs.getByQuery</code>",id:"civitaijobsgetbyquery",level:3},{value:"<code>civitai.jobs.cancel</code>",id:"civitaijobscancel",level:3},{value:"<code>civitai.models.get</code>",id:"civitaimodelsget",level:3},{value:"Webhooks",id:"webhooks",level:2},{value:"Setting webhooks",id:"setting-webhooks",level:3},{value:"Receiving webhooks",id:"receiving-webhooks",level:3},{value:"Testing your webhook code",id:"testing-your-webhook-code",level:3},{value:"Examples",id:"examples",level:2},{value:"Contribution",id:"contribution",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Setting Up for Development",id:"setting-up-for-development",level:3},{value:"Building from Source",id:"building-from-source",level:3},{value:"Running Tests",id:"running-tests",level:3},{value:"Contributing Your Changes",id:"contributing-your-changes",level:3},{value:"Additional Guidelines",id:"additional-guidelines",level:3}],p={toc:d};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"civitai-generator-nodejs-client"},"Civitai Generator Node.js Client"),(0,r.kt)("p",null,"A node.js client for Civitai's generator to run Civitai models from your Node.js code."),(0,r.kt)("h2",{id:"installation"},"Installation"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install civitai\n")),(0,r.kt)("h2",{id:"usage"},"Usage"),(0,r.kt)("h4",{id:"create-the-client"},"Create the client:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// ESM (where `"type": module` in package.json or using .mjs extension)\nimport { Civitai } from "civitai";\n\n// CommonJS (using .cjs extension)\nconst Civitai = require("civitai");\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const civitai = new Civitai({\n  auth: "YOUR_API_TOKEN",\n});\n')),(0,r.kt)("h4",{id:"create-a-txt2img-job"},"Create a txt2img job:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { Scheduler } from "civitai";\n\nconst input = {\n  model: "urn:air:sd1:checkpoint:civitai:4201@130072",\n  params: {\n    prompt:\n      "RAW photo, face portrait photo of 26 y.o woman, wearing black dress, happy face, hard shadows, cinematic shot, dramatic lighting",\n    negativePrompt:\n      "(deformed iris, deformed pupils, semi-realistic, cgi, 3d, render, sketch, cartoon, drawing, anime, mutated hands and fingers:1.4), (deformed, distorted, disfigured:1.3)",\n    scheduler: Scheduler.EULER_A,\n    steps: 20,\n    cfgScale: 7,\n    width: 512,\n    height: 512,\n    clipSkip: 2,\n  },\n};\n')),(0,r.kt)("p",null,"Run a model:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const response = await civitai.image.fromText(input);\n")),(0,r.kt)("p",null,"Then fetch the result later:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const output = civitai.jobs.get(response.token);\n")),(0,r.kt)("p",null,"Or wait for the job to finish by running the generation in the background a.k.a long polling:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const response = await civitai.image.fromText(input, true); // Add true flag\n")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Note: Jobs timeout after 10 minutes.")),(0,r.kt)("h3",{id:"using-additional-networks"},"Using Additional Networks"),(0,r.kt)("p",null,"The SDK supports additional networks: LoRA, VAE, Hypernetwork, Textual Inversion, LyCORIS, Checkpoint, and LoCon. See the full list ",(0,r.kt)("a",{parentName:"p",href:"src/models/AssetType.ts"},"here"),"."),(0,r.kt)("p",null,"To use any of the networks availabe on Civitai, simply the ",(0,r.kt)("inlineCode",{parentName:"p"},"additionNetworks")," field into the input:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { Scheduler, AssetType } from "civitai";\n\nconst input = {\n  model: "urn:air:sd1:checkpoint:civitai:4384@128713",\n  params: {\n    prompt:\n      "masterpiece, best quality, 1girl, IncrsAhri, multiple tails, fox tail, korean clothes, skirt, braid, arms behind back",\n    negativePrompt:\n      "(worst quality:1.4), (low quality:1.4), simple background, bad anatomy",\n    scheduler: Scheduler.EULER_A,\n    steps: 25,\n    cfgScale: 7,\n    width: 512,\n    height: 768,\n    seed: -1,\n    clipSkip: 2,\n  },\n  // Add this `additionalNetworks` field\n  additionalNetworks: {\n    "urn:air:sd1:lora:civitai:162141@182559": {\n      type: AssetType.LORA,\n      strength: 1.0,\n    },\n  },\n};\n')),(0,r.kt)("p",null,"In the case of ",(0,r.kt)("inlineCode",{parentName:"p"},"Lora")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"LoCon")," networks, set the ",(0,r.kt)("inlineCode",{parentName:"p"},"strength")," of the network; for ",(0,r.kt)("inlineCode",{parentName:"p"},"TextualInversion"),", set the ",(0,r.kt)("inlineCode",{parentName:"p"},"triggerWord")," of the network."),(0,r.kt)("br",null),(0,r.kt)("h2",{id:"api"},"API"),(0,r.kt)("h3",{id:"constructor"},"Constructor"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const civitai = new Civitai(options);\n")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"name"),(0,r.kt)("th",{parentName:"tr",align:null},"type"),(0,r.kt)("th",{parentName:"tr",align:null},"description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"auth")),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Required"),". API access token")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"env")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"dev")," ","|"," ",(0,r.kt)("inlineCode",{parentName:"td"},"production")),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. The environment to use. Default is ",(0,r.kt)("inlineCode",{parentName:"td"},"production"),".")))),(0,r.kt)("h3",{id:"civitaiimagefromtext"},(0,r.kt)("inlineCode",{parentName:"h3"},"civitai.image.fromText")),(0,r.kt)("p",null,"Run a model with inputs you provide."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const response = await civitai.image.fromText(options);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "token": "W3siSm9icyI6WyJjYzJkOGViNy1mOGE0LTRkNzYtOTE3Yi01OTliODRiZmRmNmYiXX1d",\n  "jobs": [\n    {\n      "jobId": "cc2d8eb7-f8a4-4d76-917b-599b84bfdf6f",\n      "cost": 1.2000000000000002,\n      "result": {\n        "blobKey": "0B60A87CDFB8E7307D0F19F623EBD8240307BD9C2345CD03B7E52A489A52CC47",\n        "available": false\n      },\n      "scheduled": true\n    }\n  ]\n}\n')),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"name"),(0,r.kt)("th",{parentName:"tr",align:null},"type"),(0,r.kt)("th",{parentName:"tr",align:null},"description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"model")),(0,r.kt)("td",{parentName:"tr",align:null},"string ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Required"),". The Civitai model to use for generation.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"params.prompt")),(0,r.kt)("td",{parentName:"tr",align:null},"string ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Required"),". The main prompt for the image generation.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"params.negativePrompt")),(0,r.kt)("td",{parentName:"tr",align:null},"string ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. The negative prompt for the image generation.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"params.scheduler")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"src/models/Scheduler.ts"},"Scheduler")," ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. The scheduler algorithm to use. ",(0,r.kt)("br",null)," ",(0,r.kt)("br",null),"Possible values are: ",(0,r.kt)("inlineCode",{parentName:"td"},"EulerA"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"Euler"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"LMS"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"Heun"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DPM2"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DPM2A"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DPM2SA"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DPM2M"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DPMSDE"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DPMFast"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DPMAdaptive"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"LMSKarras"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DPM2Karras"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DPM2AKarras"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DPM2SAKarras"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DPM2MKarras"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DPMSDEKarras"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DDIM"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"PLMS"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"UniPC"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"Undefined"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"LCM"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DDPM"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DEIS"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"params.steps")),(0,r.kt)("td",{parentName:"tr",align:null},"number ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. The number of steps for the image generation process.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"params.cfgScale")),(0,r.kt)("td",{parentName:"tr",align:null},"number ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. The CFG scale for the image generation.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"params.width")),(0,r.kt)("td",{parentName:"tr",align:null},"number"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Required"),". The width of the generated image.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"params.height")),(0,r.kt)("td",{parentName:"tr",align:null},"number"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("strong",{parentName:"td"},"Required"),". The height of the generated image.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"params.seed")),(0,r.kt)("td",{parentName:"tr",align:null},"number ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. The seed for the image generation process.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"params.clipSkip")),(0,r.kt)("td",{parentName:"tr",align:null},"number ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. The number of CLIP skips for the image generation.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"callbackUrl")),(0,r.kt)("td",{parentName:"tr",align:null},"string ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. URL that will be invoked upon completion of this job")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"additionalNetworks")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"src/models/ImageJobNetworkParams.ts"},"ImageJobNetworkParams")," ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. An associative list of additional networks, keyed by the AIR of the network. Each network is of type ",(0,r.kt)("a",{parentName:"td",href:"src/models/AssetType.ts"},"AssetType"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"controlNets")),(0,r.kt)("td",{parentName:"tr",align:null},"Array<",(0,r.kt)("a",{parentName:"td",href:"src/models/ImageJobControlNet.ts"},"ImageJobControlNet"),"> ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. An associative list of additional networks.")))),(0,r.kt)("h4",{id:"additional-networks"},"Additional Networks"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"th"},"additionalNetworks")),(0,r.kt)("th",{parentName:"tr",align:null},"Record<string, ",(0,r.kt)("a",{parentName:"th",href:"src/models/ImageJobNetworkParams.ts"},"ImageJobNetworkParams"),">"),(0,r.kt)("th",{parentName:"tr",align:null},"Optional. An associative list of additional networks, keyed by the AIR of the network. Each network is described by an ",(0,r.kt)("inlineCode",{parentName:"th"},"ImageJobNetworkParams")," object."))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"type")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"src/models/AssetType.ts"},(0,r.kt)("inlineCode",{parentName:"a"},"AssetType"))),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. The type of the asset. ",(0,r.kt)("br",null),(0,r.kt)("br",null),"Can be one of ",(0,r.kt)("inlineCode",{parentName:"td"},"Lora"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"Hypernetwork"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"TextualInversion"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"Lycoris"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"Checkpoint"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"Vae"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"LoCon"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"strength")),(0,r.kt)("td",{parentName:"tr",align:null},"number"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. In case of Lora and LoCon, set the strength of the network.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"triggerWord")),(0,r.kt)("td",{parentName:"tr",align:null},"string"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. In case of a TextualInversion, set the trigger word of the network.")))),(0,r.kt)("h4",{id:"controlnets"},"ControlNets"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"th"},"controlNets")),(0,r.kt)("th",{parentName:"tr",align:null},"Array<",(0,r.kt)("a",{parentName:"th",href:"src/models/ImageJobControlNet.ts"},"ImageJobControlNet"),">"),(0,r.kt)("th",{parentName:"tr",align:null},"Optional. An array of control networks that can be applied to the image generation process. ",(0,r.kt)("br",null),(0,r.kt)("br",null),"Each ",(0,r.kt)("inlineCode",{parentName:"th"},"ImageJobControlNet")," object in the array can have the following properties:"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"preprocessor")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"src/models/ImageTransformer.ts"},"ImageTransformer")," ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. Specifies the image transformer to be applied as a preprocessor. ",(0,r.kt)("br",null),(0,r.kt)("br",null),"Possible values are ",(0,r.kt)("inlineCode",{parentName:"td"},"Canny"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"DepthZoe"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"SoftedgePidinet"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"Rembg"),".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"weight")),(0,r.kt)("td",{parentName:"tr",align:null},"number ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. The weight of the control net.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"startStep")),(0,r.kt)("td",{parentName:"tr",align:null},"number ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. The step at which the control net starts to apply.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"endStep")),(0,r.kt)("td",{parentName:"tr",align:null},"number ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. The step at which the control net stops applying.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"imageUrl")),(0,r.kt)("td",{parentName:"tr",align:null},"string ","|"," null"),(0,r.kt)("td",{parentName:"tr",align:null},"Optional. The URL of the image associated with the controlnet.")))),(0,r.kt)("h3",{id:"civitaijobsgetbyid"},(0,r.kt)("inlineCode",{parentName:"h3"},"civitai.jobs.getById")),(0,r.kt)("p",null,"Fetches the status of a job by its unique jobId."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const response = await civitai.jobs.getById(jobId);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jobId": "3f071548-46c6-40d5-8e5a-210aa6b8bccc",\n  "cost": 1.2000000000000002,\n  "result": {\n    "blobKey": "27E0CD13EC240389EFB9A9C25EB29DC3B4AB74A973F132D6A6DB076C8B210570",\n    "available": true,\n    "blobUrl": "https://blobs-temp.sfo3...",\n    "blobUrlExpirationDate": "2024-03-04T08:04:02.4149309Z"\n  },\n  "scheduled": false\n}\n')),(0,r.kt)("h3",{id:"civitaijobsgetbytoken"},(0,r.kt)("inlineCode",{parentName:"h3"},"civitai.jobs.getByToken")),(0,r.kt)("p",null,"Get jobs associated with a token."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const response = await civitai.jobs.getByToken(token);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "token": "W3siSm9icyI6WyIzZjA3MTU0OC00NmM2LTQwZDUtOGU1YS0yMTBhYTZiOGJjY2MiXX1d",\n  "jobs": [\n    {\n      "jobId": "3f071548-46c6-40d5-8e5a-210aa6b8bccc",\n      "cost": 1.2000000000000002,\n      "result": {\n        "blobKey": "27E0CD13EC240389EFB9A9C25EB29DC3B4AB74A973F132D6A6DB076C8B210570",\n        "available": true,\n        "blobUrl": "https://blobs-temp.sfo3...",\n        "blobUrlExpirationDate": "2024-03-04T08:00:44.8268514Z"\n      },\n      "scheduled": false\n    }\n  ]\n}\n')),(0,r.kt)("h3",{id:"civitaijobsgetbyquery"},(0,r.kt)("inlineCode",{parentName:"h3"},"civitai.jobs.getByQuery")),(0,r.kt)("p",null,"Retrieve a collection of jobs by quering properties, e.g., ",(0,r.kt)("inlineCode",{parentName:"p"},"userId"),". You can optionally include a ",(0,r.kt)("inlineCode",{parentName:"p"},"detailed")," boolean flag to get detailed information about the jobs."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const query: QueryJobsRequest = {\n  properties: {\n    userId: 4, // Querying by userId\n  },\n};\nconst detailed = false; // Optional boolean flag to get detailed job definitions. False by default.\nconst response = await civitai.jobs.getByQuery(query, detailed);\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "jobs": [\n    {\n      "jobId": "AA588B7B3EC68D88A02501121A08499E4B41664820C0F8D12F4119D8C49C04C9",\n      "cost": 1.54375,\n      "properties": {\n        "userId": 4,\n        "requestId": -1,\n        "RequestId": "eb6a8c28-c806-42e2-a349-5325702a1a96"\n      },\n      "result": {\n        "blobKey": "AA588B7B3EC68D88A02501121A08499E4B41664820C0F8D12F4119D8C49C04C9",\n        "available": false\n      },\n      "serviceProviders": {},\n      "scheduled": false\n    },\n    {\n      "jobId": "59B1C81ACFA3E55B9C60BCB6472DF271F3698CC0FFE154E76C7B27D5AD1934AF",\n      "cost": 1.54375,\n      "properties": {\n        "userId": 4,\n        "requestId": -1,\n        "RequestId": "eb6a8c28-c806-42e2-a349-5325702a1a96"\n      }\n    }\n  ]\n}\n')),(0,r.kt)("h3",{id:"civitaijobscancel"},(0,r.kt)("inlineCode",{parentName:"h3"},"civitai.jobs.cancel")),(0,r.kt)("p",null,"Cancel a job by its jobId."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const response = await civitai.jobs.cancel(jobId);\n")),(0,r.kt)("p",null,"This method cancels a job that is currently scheduled or running. It requires the ",(0,r.kt)("inlineCode",{parentName:"p"},"jobId")," of the job you wish to cancel. On successful cancellation, it returns a response object indicating the cancellation status."),(0,r.kt)("p",null,"Example response:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'{\n  "status": 200,\n}\n\n')),(0,r.kt)("h3",{id:"civitaimodelsget"},(0,r.kt)("inlineCode",{parentName:"h3"},"civitai.models.get")),(0,r.kt)("p",null,"To check the coverage of specific models, you can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"civitai.models.get")," method. This method retrieves the availability of the requested models."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const models = [\n  "urn:air:sd1:checkpoint:civitai:107842@275408",\n  "urn:air:sd1:lora:civitai:162141@182559",\n];\nconst coverage = await civitai.models.get(models);\nconsole.log("Model coverage: ", coverage);\n')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "urn:air:sd1:checkpoint:civitai:107842@275408": {\n    "availability": "Unavailable",\n    "workers": 0\n  },\n  "urn:air:sd1:lora:civitai:162141@182559": {\n    "availability": "Available",\n    "workers": 1\n  }\n}\n')),(0,r.kt)("h2",{id:"webhooks"},"Webhooks"),(0,r.kt)("p",null,"Webhooks provide real-time updates about your generation. Specify an endpoint when you create a generation, and Civitai will send HTTP POST requests to that URL when the generation is completed."),(0,r.kt)("p",null,"Some scenarios where webhooks are useful:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Sending notifications when long-running generations finish"),". Some predictions like training jobs can take several minutes to run. You can use a webhook handler to send a notification like an email or a Slack message when a prediction completes."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Creating model pipelines.")," You can use webhooks to capture the output of one long-running prediction and pipe it into another model as input.")),(0,r.kt)("p",null,"Note: Webhooks are handy, but they\u2019re not strictly necessary to use Civitai SDK, and there are other ways to receive updates. You can also poll the generation API check the status of a generation over time."),(0,r.kt)("h3",{id:"setting-webhooks"},"Setting webhooks"),(0,r.kt)("p",null,"To use webhooks, specify a ",(0,r.kt)("inlineCode",{parentName:"p"},"webhook URL")," in the request body when creating a generation.\nHere\u2019s an example using the Civitai JavaScript client:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'await civitai.image.fromText({\n  input: {\n    model: "urn:air:sd1:checkpoint:civitai:4384@128713",\n    params: {\n      prompt: "a cat in a field of flowers",\n      ...\n    },\n    webhook: "https://example.com/webhook",\n  }\n});\n')),(0,r.kt)("h3",{id:"receiving-webhooks"},"Receiving webhooks"),(0,r.kt)("p",null,"Here\u2019s an example of a Next.js webhook handler:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// app/api/webhook/route.ts\nimport { NextResponse } from "next/server";\n\nexport async function POST(req: Request) {\n  try {\n    const data = await req.json();\n\n    if (data) {\n      return NextResponse.json(\n        {\n          success: true,\n          message: "Webhook received successfully",\n          data,\n        },\n        { status: 200 }\n      );\n    } else {\n      return new Response("Missing output", { status: 400 });\n    }\n  } catch (error) {\n    console.error("Error handling webhook data:", error);\n    return NextResponse.json(\n      { error: "Internal Server Error", message: error },\n      { status: 500 }\n    );\n  }\n}\n')),(0,r.kt)("p",null,"By default, Civitai sends requests to your webhook URL whenever there are new outputs or the generation has finished."),(0,r.kt)("p",null,"Your endpoint should respond with a 2xx status code within a few seconds, otherwise the webhook might be retried."),(0,r.kt)("h3",{id:"testing-your-webhook-code"},"Testing your webhook code"),(0,r.kt)("p",null,"When writing the code for your new webhook handler, it\u2019s useful to be able to receive real webhooks in your development environment so you can verify your code is handling them as expected."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://ngrok.com/"},"ngrok")," is a free reverse proxy tool that can create a secure tunnel to your local machine so you can receive webhooks. If you have Node.js installed, run ngrok directly from the command line using the npx command that\u2019s included with Node.js."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash!"},"npx ngrok http 3000\n")),(0,r.kt)("p",null,"The command above will generate output that looks like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Session Status                online\nSession Expires               1 hour, 59 minutes\nVersion                       2.3.41\nRegion                        United States (us)\nWeb Interface                 http://127.0.0.1:4040\nForwarding                    http://3e48-20-171-41-18.ngrok.io -> http://localhost:3000\nForwarding                    https://3e48-20-171-41-18.ngrok.io -> http://localhost:3000\n")),(0,r.kt)("p",null,"Here\u2019s an example using the ",(0,r.kt)("inlineCode",{parentName:"p"},"civitai")," JavaScript client:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'await civitai.image.fromText({\n  input: {\n    model: "urn:air:sd1:checkpoint:civitai:4384@128713",\n    params: {\n      prompt: "a cat in a field of flowers",\n      ...\n    },\n    webhook: "https://3e48-20-171-41-18.ngrok.io/api/webhooks",\n  }\n});\n')),(0,r.kt)("p",null,"Your webhook handler should now receive webhooks from Civitai. Once you\u2019ve deployed your app, change the value of the webhook URL to your production webhook handler endpoint when creating generations."),(0,r.kt)("h2",{id:"examples"},"Examples"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://github.com/civitai/civitai-javascript/tree/master/examples/nextjs-txt2img"},"Build a web app with Next.js App Router")),(0,r.kt)("h2",{id:"contribution"},"Contribution"),(0,r.kt)("p",null,"Contributions to the Civitai Generator Node.js Client are welcome! Here's how you can contribute or build the project from source."),(0,r.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Node.js (version specified in ",(0,r.kt)("inlineCode",{parentName:"li"},"package.json")," under ",(0,r.kt)("inlineCode",{parentName:"li"},"engines.node"),")"),(0,r.kt)("li",{parentName:"ul"},"npm or yarn (version specified in ",(0,r.kt)("inlineCode",{parentName:"li"},"package.json")," under ",(0,r.kt)("inlineCode",{parentName:"li"},"engines.npm")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"engines.yarn"),")")),(0,r.kt)("h3",{id:"setting-up-for-development"},"Setting Up for Development"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Fork and clone the repository."),(0,r.kt)("li",{parentName:"ol"},"Install dependencies:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install\n")),(0,r.kt)("h3",{id:"building-from-source"},"Building from Source"),(0,r.kt)("p",null,"To build the project from source:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm run build\n")),(0,r.kt)("p",null,"This will compile the TypeScript files and generate the necessary JavaScript files in the ",(0,r.kt)("inlineCode",{parentName:"p"},"dist")," directory."),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"Create a ",(0,r.kt)("inlineCode",{parentName:"li"},".env.test")," file in the root directory and add your Civitai API token, i.e., ",(0,r.kt)("inlineCode",{parentName:"li"},"CIVITAI_API_TOKEN"),".")),(0,r.kt)("h3",{id:"running-tests"},"Running Tests"),(0,r.kt)("p",null,"To ensure your changes don't break existing functionality, run the tests:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm run test\n")),(0,r.kt)("h3",{id:"contributing-your-changes"},"Contributing Your Changes"),(0,r.kt)("p",null,"After making your changes:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Push your changes to your fork."),(0,r.kt)("li",{parentName:"ol"},"Open a pull request against the main repository."),(0,r.kt)("li",{parentName:"ol"},"Describe your changes and how they improve the project or fix issues.")),(0,r.kt)("p",null,"Your contributions will be reviewed, and if accepted, merged into the project."),(0,r.kt)("h3",{id:"additional-guidelines"},"Additional Guidelines"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Include unit tests for new features or bug fixes."),(0,r.kt)("li",{parentName:"ul"},"Update the documentation if necessary.")),(0,r.kt)("p",null,"Thank you for contributing to the Civitai Generator Node.js Client! \ud83e\udd79\ud83e\udd2d"))}u.isMDXComponent=!0}}]);